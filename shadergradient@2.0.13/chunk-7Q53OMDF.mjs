import{d as k}from"./chunk-V2B32BRK.mjs";import{I as O,i as _,k as y,l as R,v as u}from"./chunk-O4LYKYI3.mjs";var M=class extends O{constructor(s){super(s),this.type=R}parse(s){let p=function(r,e){switch(r){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(e||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(e||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(e||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(e||""))}},U=`
`,F=function(r,e,t){e=e||1024;let f=r.pos,a=-1,o=0,n="",m=String.fromCharCode.apply(null,new Uint16Array(r.subarray(f,f+128)));for(;0>(a=m.indexOf(U))&&o<e&&f<r.byteLength;)n+=m,o+=m.length,f+=128,m+=String.fromCharCode.apply(null,new Uint16Array(r.subarray(f,f+128)));return-1<a?(t!==!1&&(r.pos+=o+a+1),n+m.slice(0,a)):!1},I=function(r){let e=/^#\?(\S+)/,t=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,f=/^\s*FORMAT=(\S+)\s*$/,a=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,o={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0},n,m;for((r.pos>=r.byteLength||!(n=F(r)))&&p(1,"no header found"),(m=n.match(e))||p(3,"bad initial token"),o.valid|=1,o.programtype=m[1],o.string+=n+`
`;n=F(r),n!==!1;){if(o.string+=n+`
`,n.charAt(0)==="#"){o.comments+=n+`
`;continue}if((m=n.match(t))&&(o.gamma=parseFloat(m[1])),(m=n.match(i))&&(o.exposure=parseFloat(m[1])),(m=n.match(f))&&(o.valid|=2,o.format=m[1]),(m=n.match(a))&&(o.valid|=4,o.height=parseInt(m[1],10),o.width=parseInt(m[2],10)),o.valid&2&&o.valid&4)break}return o.valid&2||p(3,"missing format specifier"),o.valid&4||p(3,"missing image size specifier"),o},K=function(r,e,t){let i=e;if(i<8||i>32767||r[0]!==2||r[1]!==2||r[2]&128)return new Uint8Array(r);i!==(r[2]<<8|r[3])&&p(3,"wrong scanline width");let f=new Uint8Array(4*e*t);f.length||p(4,"unable to allocate buffer space");let a=0,o=0,n=4*i,m=new Uint8Array(4),c=new Uint8Array(n),H=t;for(;H>0&&o<r.byteLength;){o+4>r.byteLength&&p(1),m[0]=r[o++],m[1]=r[o++],m[2]=r[o++],m[3]=r[o++],(m[0]!=2||m[1]!=2||(m[2]<<8|m[3])!=i)&&p(3,"bad rgbe scanline format");let g=0,l;for(;g<n&&o<r.byteLength;){l=r[o++];let d=l>128;if(d&&(l-=128),(l===0||g+l>n)&&p(3,"bad scanline data"),d){let h=r[o++];for(let V=0;V<l;V++)c[g++]=h}else c.set(r.subarray(o,o+l),g),g+=l,o+=l}let W=i;for(let d=0;d<W;d++){let h=0;f[a]=c[d+h],h+=i,f[a+1]=c[d+h],h+=i,f[a+2]=c[d+h],h+=i,f[a+3]=c[d+h],a+=4}H--}return f},N=function(r,e,t,i){let f=r[e+3],a=Math.pow(2,f-128)/255;t[i+0]=r[e+0]*a,t[i+1]=r[e+1]*a,t[i+2]=r[e+2]*a,t[i+3]=1},X=function(r,e,t,i){let f=r[e+3],a=Math.pow(2,f-128)/255;t[i+0]=u.toHalfFloat(Math.min(r[e+0]*a,65504)),t[i+1]=u.toHalfFloat(Math.min(r[e+1]*a,65504)),t[i+2]=u.toHalfFloat(Math.min(r[e+2]*a,65504)),t[i+3]=u.toHalfFloat(1)},E=new Uint8Array(s);E.pos=0;let L=I(E),w=L.width,v=L.height,G=K(E.subarray(E.pos),w,v),B,P,S;switch(this.type){case y:S=G.length/4;let r=new Float32Array(S*4);for(let t=0;t<S;t++)N(G,t*4,r,t*4);B=r,P=y;break;case R:S=G.length/4;let e=new Uint16Array(S*4);for(let t=0;t<S;t++)X(G,t*4,e,t*4);B=e,P=R;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:w,height:v,data:B,header:L.string,gamma:L.gamma,exposure:L.exposure,type:P}}setDataType(s){return this.type=s,this}load(s,T,C,b){function A(p,x){switch(p.type){case y:case R:"colorSpace"in p?p.colorSpace="srgb-linear":p.encoding=3e3,p.minFilter=_,p.magFilter=_,p.generateMipmaps=!1,p.flipY=!0;break}T&&T(p,x)}return super.load(s,A,C,b)}};function rr(D,{path:s}){return k(M,D,C=>C.setPath(s))}export{rr as a};
